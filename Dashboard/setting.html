<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="Config.js"></script> <!-- ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î CONFIG_URL -->
</head>
<body class="bg-gray-100 min-h-screen flex">
  <aside class="w-64 bg-white p-4 shadow">
    <h2 class="text-xl font-bold mb-4">Dashboard</h2>
    <nav>
      <a href="service.html" class="block mb-2">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</a>
      <a href="member.html" class="block mb-2 ">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
      <a href="#" class="block mb-2 font-bold text-blue-600">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a>
    </nav>
  </aside>
  <section class="w-1/2 p-6 rounded shadow mb-6">
    <h2 class="text-xl font-semibold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h2>
    <button onclick="showTimeSlotForm()" class="bg-blue-600 text-white px-4 py-2 rounded mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</button>
    <div id="timeSlotFormSection" class="hidden mb-4">
      <form id="timeSlotForm" class="grid grid-cols-3 gap-4 items-center">
        <input name="‡πÑ‡∏≠‡∏î‡∏µ" class="border p-2 rounded" readonly placeholder="ID ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥">
        <input name="‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤" type="time" required class="border p-2 rounded">
        <input name="‡∏™‡∏•‡∏≠‡∏ï" type="number" required class="border p-2 rounded">
        <button type="submit" class="col-span-3 bg-green-600 text-white px-4 py-2 rounded">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </form>
    </div>
    <div id="timeSlotTable" class="overflow-x-auto"></div>
  </section>

  <!-- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î -->
  <section class="w-1/2 p-6 rounded shadow">
    <h2 class="text-xl font-semibold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</h2>
    <div class="flex gap-2 mb-4">
      <input id="holidayInput" type="date" class="border p-2 rounded">
      <button onclick="addHoliday()" class="bg-blue-500 text-white px-4 py-2 rounded">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</button>
    </div>
    <div id="holidayTable" class="overflow-x-auto"></div>
  </section>

  <script>
    function showTimeSlotForm() {
      document.getElementById('timeSlotFormSection').classList.remove('hidden');
    }

    document.getElementById('timeSlotForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const data = {};
      new FormData(this).forEach((v, k) => data[k] = v);
      fetch(CONFIG_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'insertOrUpdateTimeSlot', data })
      }).then(r => r.json()).then(() => {
        this.reset();
        loadTimeSlots();
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
      });
    });

    function loadTimeSlots() {
      fetch(`${CONFIG_URL}?action=fetchTimeSlots`).then(r => r.json()).then(data => {
        let html = `
          <table class="min-w-full text-sm text-left">
            <thead class="bg-gray-200"><tr>
              <th class="p-2">‡πÑ‡∏≠‡∏î‡∏µ</th>
              <th class="p-2">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</th>
              <th class="p-2">‡∏™‡∏•‡∏≠‡∏ï</th>
              <th class="p-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr></thead><tbody>`;
        data.forEach(t => {
          html += `<tr class="border-t">
            <td class="p-2">${t['‡πÑ‡∏≠‡∏î‡∏µ']}</td>
            <td class="p-2">${t['‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤']}</td>
            <td class="p-2">${t['‡∏™‡∏•‡∏≠‡∏ï']}</td>
            <td class="p-2">
              <button onclick="editTimeSlot('${t['‡πÑ‡∏≠‡∏î‡∏µ']}')" class="bg-green-500 text-white px-2 py-1 rounded">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button onclick="deleteTimeSlot('${t['‡πÑ‡∏≠‡∏î‡∏µ']}')" class="bg-red-500 text-white px-2 py-1 rounded">‡∏•‡∏ö</button>
            </td>
          </tr>`;
        });
        html += '</tbody></table>';
        document.getElementById('timeSlotTable').innerHTML = html;
      });
    }

    function editTimeSlot(id) {
      fetch(`${CONFIG_URL}?action=fetchTimeSlots`).then(r => r.json()).then(data => {
        const t = data.find(x => x['‡πÑ‡∏≠‡∏î‡∏µ'] === id);
        if (!t) return;
        const form = document.getElementById('timeSlotForm');
        form['‡πÑ‡∏≠‡∏î‡∏µ'].value = t['‡πÑ‡∏≠‡∏î‡∏µ'];
        form['‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤'].value = t['‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤'];
        form['‡∏™‡∏•‡∏≠‡∏ï'].value = t['‡∏™‡∏•‡∏≠‡∏ï'];
        showTimeSlotForm();
      });
    }

    function deleteTimeSlot(id) {
      Swal.fire({ title: '‡∏•‡∏ö‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ?', showCancelButton: true }).then(res => {
        if (res.isConfirmed) {
          fetch(CONFIG_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'deleteTimeSlot', id })
          }).then(() => {
            loadTimeSlots();
            Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '', 'success');
          });
        }
      });
    }

    function addHoliday() {
      const date = document.getElementById('holidayInput').value;
      if (!date) return Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', '', 'warning');
      fetch(CONFIG_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'addHoliday', date })
      }).then(() => {
        loadHolidays();
        Swal.fire('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß', '', 'success');
      });
    }

    function loadHolidays() {
      fetch(`${CONFIG_URL}?action=fetchHolidays`).then(r => r.json()).then(data => {
        let html = `
          <table class="min-w-full text-sm text-left">
            <thead class="bg-gray-200"><tr>
              <th class="p-2">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</th>
              <th class="p-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr></thead><tbody>`;
        data.forEach(d => {
          html += `<tr class="border-t">
            <td class="p-2">${d}</td>
            <td class="p-2">
              <button onclick="deleteHoliday('${d}')" class="bg-red-500 text-white px-2 py-1 rounded">‡∏•‡∏ö</button>
            </td>
          </tr>`;
        });
        html += '</tbody></table>';
        document.getElementById('holidayTable').innerHTML = html;
      });
    }

    function deleteHoliday(date) {
      Swal.fire({ title: `‡∏•‡∏ö ${date}?`, showCancelButton: true }).then(res => {
        if (res.isConfirmed) {
          fetch(CONFIG_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'deleteHoliday', date })
          }).then(() => {
            loadHolidays();
            Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '', 'success');
          });
        }
      });
    }

    loadTimeSlots();
    loadHolidays();
  </script>
</body>
</html>
